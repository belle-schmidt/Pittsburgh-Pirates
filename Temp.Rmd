### Linear Models For Extension and Stuff+ or An Outcome Variable

# Function That Calculates The Slope of The Linear Model For Each Year 
```{r}
extension_slope <- function(tidy_dataset){

  # Calculates the slope of the line for each year
  slope <- tidy_dataset |> 
    select(term, estimate) |> 
  mutate(term = recode(term, "extension" = "extension_2020")) |> 
  pivot_wider(names_from = term, values_from = estimate) |> 
  select(extension_2020:`season2024:extension`) |> 
  mutate(slope2021 = extension_2020 + `season2021:extension`, 
         slope2022 = extension_2020 + `season2022:extension`,
         slope2023 = extension_2020 + `season2023:extension`,
         slope2024 = extension_2020 + `season2024:extension`) |> 
  select(extension_2020, slope2021:slope2024) |> 
  pivot_longer(cols = c(extension_2020, slope2021:slope2024), names_to = "season", values_to = "slope") |> 
  mutate(season = str_extract(season, "\\d{4}"))
  
  # Extracts the std_error for each year
  std_error <- tidy_dataset |> 
  mutate(term = recode(term, "extension" = "extension_2020")) |>
  select(term, std.error) |> 
  filter(term == c("extension_2020", "season2021:extension", "season2022:extension", "season2023:extension", "season2024:extension"))|> 
    rename(season = term) |> 
    mutate(season = str_extract(season, "\\d{4}"))
  
  # Joins the slope and std_errors into one dataset
  full_join(slope, std_error)  
}
```

# Linear Model For Stuff Plus and Extension
```{r}
# Linear model for extension and stuff+
extension_lm <- lm(stuff_plus ~ season * extension, 
                data = fastball_data) 

summary(extension_lm)
tidy_extension_lm <-tidy(extension_lm)

# Calls the function above that calculates the slope of the linear model for each year
extension_stuff_plus_slope <- extension_slope(tidy_extension_lm)

extension_stuff_plus_slope
```

# Graph of Slope For Each Year's Extension and Stuff+ Linear Model
```{r}
  ggplot() +
  geom_line(data = extension_stuff_plus_slope, mapping = aes(x = season, y = slope), size = 1, group = 1, color = "red") +
  geom_point(data = extension_stuff_plus_slope, mapping = aes(x = season, y = slope), color = "black", size = 2) +
  # geom_ribbon(data = tidy_extension_lm, aes(ymin = slope - std_error, ymax = slope + std_error), fill = "grey") +
  labs(title = "Impact Each RPM of Spin Has on Stuff+ Per Season",
       x = "Year",
       y = "Change in Stuff+ Per RPM of Spin") +
  theme + 
  theme(plot.title = element_text(size = 15),
        axis.title.y = element_text(size = 10),
        axis.text.x = element_text(size = 10))
```

# Linear Model For Whiff Percentage and Extension
```{r}
# Linear model for extension predicting whiff percentage
extension_whiff_lm <- lm(whiff_pct ~ season * extension, 
                data = fastball_data) 

summary(extension_whiff_lm)
tidy_extension_whiff_lm <-tidy(extension_whiff_lm)

# Calls the function above that calculates the slope of the linear model for each year
extension_whiff_slope <- extension_slope(tidy_extension_whiff_lm)

extension_whiff_slope
```

# Graph of Slope For Each Year's Extension and Stuff+ Linear Model
```{r}
  ggplot() +
  geom_line(data = extension_whiff_slope, mapping = aes(x = season, y = slope), size = 1, group = 1, color = "red") +
  geom_point(data = extension_whiff_slope, mapping = aes(x = season, y = slope), color = "black", size = 2) +
  # geom_ribbon(data = tidy_extension_lm, aes(ymin = slope - std_error, ymax = slope + std_error), fill = "grey") +
  labs(title = "Impact Each RPM of Spin Has on Whiff Percentage Per Season",
       x = "Year",
       y = "Change in Whiff Percentage Per RPM of Spin") +
  theme +
  theme(plot.title = element_text(size = 13),
        axis.title.y = element_text(size = 9),
        axis.text.x = element_text(size = 10))
```

# Linear Model For xwOBA and Extension
```{r}
extension_xwOBA <- lm(xwOBA ~ season * extension, 
                data = fastball_data) 


summary(extension_xwOBA)
tidy_extension_xwOBA <- tidy(extension_xwOBA)

# Calls the function above that calculates the slope of the linear model for each year
extension_xwOBA_slope <- extension_slope(tidy_extension_xwOBA)

extension_xwOBA_slope
```

# Graph of Slope For Each Year's Extension and Stuff+ Linear Model
```{r}
  ggplot() +
  geom_line(data = extension_xwOBA_slope, mapping = aes(x = season, y = slope), size = 1, group = 1, color = "red") +
  geom_point(data = extension_xwOBA_slope, mapping = aes(x = season, y = slope), color = "black", size = 2) +
  # geom_ribbon(data = tidy_extension_lm, aes(ymin = slope - std_error, ymax = slope + std_error), fill = "grey") +
  labs(title = "Impact Each RPM of Spin Has on xwOBA Per Season",
       x = "Year",
       y = "Change in xwOBA Per RPM of Spin") +
  theme +
  theme(plot.title = element_text(size = 13),
        axis.title.y = element_text(size = 10),
        axis.text.x = element_text(size = 10))
```
